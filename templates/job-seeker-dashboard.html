<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Jobs - JobMatch AI</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css"
        rel="stylesheet">
    <link rel="apple-touch-icon" sizes="180x180" href="static/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="static/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="static/images/favicon-16x16.png">
    <link rel="manifest" href="static/images/site.webmanifest">
    <link rel="stylesheet" href="../static/css/job-seeker.css">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <a class="navbar-brand" href="#">
                <span class="brand-icon">
                    <i class="bi bi-stars"></i>
                </span>
                <span>JobMatch AI</span>
            </a>
            <div class="user-section">
                <span class="user-name">{{ full_name }}</span>
                <a href="{{ url_for('logout') }}" class="btn btn-sign-out">Sign Out</a>
            </div>
        </div>
    </nav>

    <!-- Navigation Tabs -->
    <div class="nav-tabs-container">
        <div class="container">
            <ul class="nav nav-tabs" role="tablist">

                <li class="nav-item">
                    <a class="nav-link active" id="browse-tab" data-bs-toggle="tab" href="#browse" role="tab">
                        Browse Jobs
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="ai-recommended-tab" data-bs-toggle="tab" href="#ai-recommended" role="tab">
                        AI Recommended Jobs
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="applications-tab" data-bs-toggle="tab" href="#applications" role="tab">
                        My Applications (2)
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="profile-tab" data-bs-toggle="tab" href="#profile" role="tab">
                        Profile
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <div class="tab-content-wrapper">

            <!-- Browse Jobs Tab -->
            <div class="tab-pane active" id="browse" role="tabpanel">
                <div class="search-section">
                    <div class="search-box">
                        <i class="bi bi-search"></i>
                        <input type="text" class="search-input"
                            placeholder="Search jobs by title, company, or skills...">
                    </div>

                    <div class="filter-buttons">
                        <button class="filter-btn active">All Jobs</button>
                        <button class="filter-btn">Full Time</button>
                        <button class="filter-btn">Part Time</button>
                        <button class="filter-btn">Contract</button>
                        <button class="filter-btn">Remote</button>
                    </div>
                </div>


                <div class="jobs-section">
                    <!-- Job Card -->
                    {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                    {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show"
                        role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                    {% endfor %}
                    {% endif %}
                    {% endwith %}

                    {% if jobs %}
                    {% for job in jobs %}
                    <form action="{{ url_for('apply_job') }}" method="post">
                        <div class="job-card">
                            <h2 class="job-title">{{ job.title }}</h2>
                            <a href="#" class="company-name">{{ job.company }}</a>

                            <div class="job-meta">
                                <div class="job-meta-item">
                                    <i class="bi bi-geo-alt"></i>
                                    <span>{{ job.location }}</span>
                                </div>
                                <div class="job-meta-item">
                                    <i class="bi bi-briefcase"></i>
                                    <span>{{ job.job_type }}</span>
                                </div>
                                <div class="job-meta-item">
                                    <span>{{ job.salary_range }}</span>
                                </div>
                                <div class="job-meta-item">
                                    <i class="bi bi-clock"></i>
                                    <span>{{ job.created_at.strftime("%B %d, %Y") }}</span>
                                </div>
                            </div>

                            <input type="hidden" name="job-id" value="{{ job.id }}">

                            <p class="job-description">{{ job.description }}</p>

                            <div class="job-tags">
                                {% for skill in job.skills_required.split(',') %}
                                <span class="job-tag">{{ skill }}</span>
                                {% endfor %}
                            </div>

                            <button type="submit" class="btn-apply">Apply Now</button>
                            <div style="clear: both;"></div>
                        </div>
                    </form>

                    {% endfor %}
                    {% else %}
                    <div>
                        <p>No jobs posted yet</p>
                    </div>
                    {% endif %}

                </div>
            </div>


            <!-- AI Recommended Jobs Tab -->
            <div class="tab-pane" id="ai-recommended" role="tabpanel">
                <div class="ai-header">
                    <h1><i class="bi bi-stars"></i> AI Recommended Jobs</h1>
                    <p>Personalized job matches based on your skills and experience</p>
                </div>

                <!-- Generate/Refresh Button -->
                <div style="margin-bottom: 2rem;">
                    <form method="POST" action="{{ url_for('job_recommendation') }}">
                        {% if has_recommendations %}
                        <button type="submit" class="btn btn-secondary">
                            <i class="bi bi-arrow-clockwise"></i> Refresh Recommendations
                        </button>
                        {% else %}
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-magic"></i> Generate AI Recommendations
                        </button>
                        {% endif %}
                    </form>
                </div>

                <div class="jobs-section">
                    {% if has_recommendations %}
                    {% for rec in recommendations %}
                    <form action="{{ url_for('apply_job') }}" method="post">
                        <div class="job-card job-card-recommended">
                            <span class="match-badge">
                                <i class="bi bi-check-circle"></i> {{ "%.0f"|format(rec.match_score * 100) }}% Match
                            </span>
                            <h2 class="job-title">{{ rec.job.title }}</h2>
                            <a href="#" class="company-name">{{ rec.job.company }}</a>

                            <div class="job-meta">
                                <div class="job-meta-item">
                                    <i class="bi bi-geo-alt"></i>
                                    <span>{{ rec.job.location }}</span>
                                </div>
                                <div class="job-meta-item">
                                    <i class="bi bi-briefcase"></i>
                                    <span>{{ rec.job.job_type }}</span>
                                </div>
                                <div class="job-meta-item">
                                    <span>{{ rec.job.salary_range }}</span>
                                </div>
                                <div class="job-meta-item">
                                    <i class="bi bi-clock"></i>
                                    <span>Posted {{ rec.job.created_at.strftime("%B %d, %Y") }}</span>
                                </div>
                            </div>

                            <p class="job-description">{{ rec.job.description }}</p>

                            <!-- Match Breakdown -->
                            {% if rec.skill_match_score or rec.location_match_score %}
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                                <h6 style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">Match
                                    Breakdown:</h6>

                                {% if rec.skill_match_score %}
                                <div style="margin-bottom: 0.5rem;">
                                    <div
                                        style="display: flex; justify-content: space-between; font-size: 0.75rem; margin-bottom: 0.25rem;">
                                        <span>Skills Match</span>
                                        <span>{{ "%.0f"|format(rec.skill_match_score * 100) }}%</span>
                                    </div>
                                    <div
                                        style="background: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                                        <div
                                            style="background: #667eea; height: 100%; width: {{ rec.skill_match_score * 100 }}%;">
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                {% if rec.location_match_score %}
                                <div style="margin-bottom: 0.5rem;">
                                    <div
                                        style="display: flex; justify-content: space-between; font-size: 0.75rem; margin-bottom: 0.25rem;">
                                        <span>Location Match</span>
                                        <span>{{ "%.0f"|format(rec.location_match_score * 100) }}%</span>
                                    </div>
                                    <div
                                        style="background: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                                        <div
                                            style="background: #28a745; height: 100%; width: {{ rec.location_match_score * 100 }}%;">
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                {% if rec.experience_match_score %}
                                <div>
                                    <div
                                        style="display: flex; justify-content: space-between; font-size: 0.75rem; margin-bottom: 0.25rem;">
                                        <span>Experience Match</span>
                                        <span>{{ "%.0f"|format(rec.experience_match_score * 100) }}%</span>
                                    </div>
                                    <div
                                        style="background: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                                        <div
                                            style="background: #ffc107; height: 100%; width: {{ rec.experience_match_score * 100 }}%;">
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}

                            <!-- Match Reasons -->
                            {% if rec.match_reasons %}
                            <div
                                style="background: #e7f3ff; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #667eea;">
                                <h6 style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">
                                    <i class="bi bi-lightbulb"></i> Why This Match:
                                </h6>
                                <ul style="margin: 0; padding-left: 1.5rem; font-size: 0.875rem;">
                                    {% for key, value in rec.match_reasons.items() %}
                                    <li><strong>{{ key|title }}:</strong> {{ value }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}

                            <!-- Missing Skills -->
                            {% if rec.missing_skills and rec.missing_skills.required %}
                            <div
                                style="background: #fff3cd; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #ffc107;">
                                <h6 style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">
                                    <i class="bi bi-exclamation-triangle"></i> Skills to Develop:
                                </h6>
                                <p style="margin: 0; font-size: 0.875rem;">
                                    {{ rec.missing_skills.required|join(', ') }}
                                    {% if rec.missing_skills.recommendation %}
                                    <br><small style="color: #856404;">{{ rec.missing_skills.recommendation }}</small>
                                    {% endif %}
                                </p>
                            </div>
                            {% endif %}

                            <div class="job-tags">
                                {% for skill in rec.job.skills_required.split(',') %}
                                <span class="job-tag">{{ skill.strip() }}</span>
                                {% endfor %}
                            </div>

                            <input type="hidden" name="job-id" value="{{ rec.job.id }}">
                            <button type="submit" class="btn-apply">Apply Now</button>
                            <div style="clear: both;"></div>
                        </div>
                    </form>
                    {% endfor %}
                    {% else %}
                    <div style="text-align: center; padding: 3rem; background: #f8f9fa; border-radius: 12px;">
                        <i class="bi bi-stars" style="font-size: 3rem; color: #667eea; margin-bottom: 1rem;"></i>
                        <h3 style="color: #212529; margin-bottom: 0.5rem;">No Recommendations Yet</h3>
                        <p style="color: #6c757d;">Click the button above to generate personalized job recommendations
                            based on your skills and profile.</p>
                    </div>
                    {% endif %}
                </div>
            </div>



            <!-- My Applications Tab -->
            <div class="tab-pane" id="applications" role="tabpanel">
                <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 2rem;">My Applications</h1>

                <div class="applications-section">
                    {% for application in applications %}
                    <!-- Application Card -->
                    <div class="application-card">
                        <div class="application-header">
                            <div>
                                <h2 class="job-title" style="font-size: 1.5rem;">{{ application.job.title }}</h2>
                                <a href="#" class="company-name">{{ application.job.company }}</a>
                            </div>
                            <span class="application-status status-pending">{{ application.status }}</span>
                        </div>

                        <div class="job-meta">
                            <div class="job-meta-item">
                                <i class="bi bi-geo-alt"></i>
                                <span>{{ application.job.location }}</span>
                            </div>
                            <div class="job-meta-item">
                                <i class="bi bi-briefcase"></i>
                                <span>{{ application.job.job_type }}</span>
                            </div>
                            <div class="job-meta-item">
                                <span>{{ application.job.salary_range }}</span>
                            </div>
                        </div>

                        <div class="application-timeline">
                            <div class="application-meta-item">
                                <i class="bi bi-calendar-check"></i>
                                <span>Applied: {{ application.job.created_at.strftime("%B %d, %Y") }}</span>
                            </div>
                            <!-- <div class="application-meta-item">
                                <i class="bi bi-eye"></i>
                                <span>Viewed by employer</span>
                            </div> -->
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Profile Tab -->
            <div class="tab-pane" id="profile" role="tabpanel">
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar">{{ full_name.split(" ")[0][0] }}{{ full_name.split(" ")[1][0] }}</div>
                        <div class="profile-info">
                            <h1>{{ full_name }}</h1>
                            <p>Frontend Developer | React Specialist</p>
                        </div>
                    </div>

                    <div class="profile-details">
                        <h2>About Me</h2>
                        <p style="color: #495057; line-height: 1.6; margin-bottom: 2rem;">
                            {{ user_profile.bio }}
                        </p>

                        <h2>Skills</h2>
                        <div class="skill-list">
                            {% for skill in user_profile.skills.split(",") %}
                            <span class="skill-item">{{ skill }}</span>
                            {% endfor %}
                        </div>

                        <h2>Experience</h2>
                        <div style="margin-bottom: 2rem;">
                            <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                                <h3
                                    style="font-size: 1.25rem; font-weight: 700; color: #212529; margin-bottom: 0.25rem;">
                                    Senior Frontend Developer</h3>
                                <p style="color: #667eea; font-weight: 600; margin-bottom: 0.5rem;">Tech Solutions Ltd •
                                    2022 - Present</p>
                                <p style="color: #495057; line-height: 1.6;">
                                    Leading the frontend development team, architecting scalable React applications,
                                    and mentoring junior developers. Improved application performance by 40%.
                                </p>
                            </div>
                        </div>

                        <h2>Education</h2>
                        <div style="margin-bottom: 2rem;">
                            <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px;">
                                <h3
                                    style="font-size: 1.25rem; font-weight: 700; color: #212529; margin-bottom: 0.25rem;">
                                    {{ user_profile.degree }}</h3>
                                <p style="color: #667eea; font-weight: 600; margin-bottom: 0.5rem;">{{ user_profile.institution }}
                                    • {{ user_profile.year_of_graduation }}</p>
                                <p style="color: #495057; line-height: 1.6;">
                                    Graduated with {{ user_profile.grade }} Honours. Specialized in {{ user_profile.area_of_specialization }}.
                                </p>
                            </div>
                        </div>

                        <button class="btn-edit-profile">
                            <i class="bi bi-pencil"></i> Edit Profile
                        </button>
                    </div>
                </div>
                
            </div>


            <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
            <script>
                // Filter button functionality
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', function () {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
            </script>
</body>

</html>